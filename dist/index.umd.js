(function(h,l){typeof exports=="object"&&typeof module<"u"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(h=typeof globalThis<"u"?globalThis:h||self,l(h.Paintbricks={}))})(this,function(h){"use strict";function l(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function k(e,t){const i=l(e,t),o={x:t.x-e.x,y:t.y-e.y};return{x:o.x/i,y:o.y/i}}class w{constructor(t){this.canvas=t,this.lastTouch=null,this.sensitivity=20,this.lastStrokeParts=[],this.onStrokePartHandlers=[],this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.destroy=this.destroy.bind(this),this.getRelativePosition=this.getRelativePosition.bind(this),this.canvas.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.canvas.addEventListener("touchend",this.onTouchEnd,{passive:!1}),this.canvas.addEventListener("touchcancel",this.onTouchCancel,{passive:!1}),this.canvas.addEventListener("touchmove",this.onTouchMove,{passive:!1})}onStrokePart(t){this.onStrokePartHandlers.push(t)}destroy(){this.onStrokePartHandlers=[],this.lastStrokeParts=[],this.canvas.removeEventListener("touchstart",this.onTouchStart),this.canvas.removeEventListener("touchend",this.onTouchEnd),this.canvas.removeEventListener("touchcancel",this.onTouchCancel),this.canvas.removeEventListener("touchmove",this.onTouchMove)}getRelativePosition(t,i){const o=this.canvas.getBoundingClientRect();return{x:t-o.left,y:i-o.top}}onTouchStart(t){if(t.preventDefault(),this.lastTouch)return;const o=t.changedTouches.item(0);this.lastTouch={id:o.identifier,position:this.getRelativePosition(o.clientX,o.clientY)}}onTouchMove(t){if(t.preventDefault(),!this.lastTouch)return;const i=t.changedTouches,o=Array.from(i).find(a=>a.identifier===this.lastTouch.id);if(!o)return;const s={id:o.identifier,position:this.getRelativePosition(o.clientX,o.clientY)};if(this.sensitivity&&l(s.position,this.lastTouch.position)<10/this.sensitivity)return;const n={endPoint:s.position,startPoint:this.lastTouch.position,isStart:this.lastStrokeParts.length===0,isEnd:!1};this.onStrokePartHandlers.forEach(a=>{a(n)}),this.lastTouch=s,this.lastStrokeParts.push(n)}onTouchEnd(t){if(t.preventDefault(),!this.lastTouch)return;const i=t.changedTouches,o=Array.from(i).find(a=>a.identifier===this.lastTouch.id);if(!o)return;const s=this.getRelativePosition(o.clientX,o.clientY),n={startPoint:this.lastTouch.position,endPoint:s,isStart:!1,isEnd:!0};this.onStrokePartHandlers.forEach(a=>{a(n)}),this.lastTouch=null,this.lastStrokeParts=[]}onTouchCancel(t){t.preventDefault(),this.lastTouch=null,this.lastStrokeParts=[]}}class b{constructor(t,i,o){this.canvas=t,this.canvasWidth=i,this.canvasHeight=o,this.currentTool=null,this.currentStroke=[],this.strokeManager=new w(t),this.canvasState=null,this.shouldDraw=!1,this.shouldCommit=!1;const s=t.getContext("2d").backingStorePixelRatio||1,n=window.devicePixelRatio||1;this.pixelRatio=n/s,this.setCanvasSize=this.setCanvasSize.bind(this),this.setTool=this.setTool.bind(this),this.destroy=this.destroy.bind(this),this.clear=this.clear.bind(this),this.draw=this.draw.bind(this),this.onStrokePart=this.onStrokePart.bind(this),this.nextAnimationFrame=window.requestAnimationFrame(this.draw),this.strokeManager.onStrokePart(this.onStrokePart),this.setCanvasSize(i,o)}setCanvasSize(t,i){this.canvasWidth=t,this.canvasHeight=i;const{canvas:o,canvasWidth:s,canvasHeight:n,pixelRatio:a}=this,u=o.getContext("2d");o.width=s*a,o.height=n*a,o.style.width=s+"px",o.style.height=n+"px",u.setTransform(a,0,0,a,0,0)}setTool(t){this.currentTool=t}destroy(){window.cancelAnimationFrame(this.nextAnimationFrame),this.strokeManager.destroy()}clear(){this.canvasState=null,this.currentStroke=[],this.shouldDraw=!0,this.shouldCommit=!0}onStrokePart(t){this.currentStroke.push(t),this.shouldDraw=!0,t.isEnd&&(this.shouldCommit=!0)}draw(){this.nextAnimationFrame=window.requestAnimationFrame(this.draw);const t=this.canvas.getContext("2d");this.shouldDraw&&(t.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.canvasState&&t.putImageData(this.canvasState,0,0),this.currentTool&&this.currentStroke.length&&(t.save(),this.currentTool.draw(t,this.currentStroke),t.restore()),this.shouldCommit&&(this.canvasState=t.getImageData(0,0,this.canvasWidth*this.pixelRatio,this.canvasHeight*this.pixelRatio),this.currentStroke=[],this.shouldCommit=!1),this.shouldDraw=!1)}}class T{constructor(t="red",i=3){this.color=t,this.width=i}draw(t,i){const o=i[0];t.beginPath(),t.lineWidth=this.width,t.strokeStyle=this.color,t.lineCap="round",t.lineJoin="round",t.moveTo(o.startPoint.x,o.startPoint.y),i.forEach(s=>{const{endPoint:n}=s;t.lineTo(n.x,n.y)}),t.stroke()}}class S{constructor(t=10,i){this.width=t,i=i||{},this.handleOpts={hide:i.hide||!1,strokeWidth:i.strokeWidth||2,fillColor:i.fillColor||"white",strokeColor:i.strokeColor||"black"}}draw(t,i){const{handleOpts:o}=this,s=this.width/2;i.forEach(a=>{const{startPoint:u,endPoint:d,isEnd:m}=a,g=l(u,d),y=k(u,d);let r=u,c=0;for(;c<g;){const f={x:r.x+y.x,y:r.y+y.y};t.clearRect(f.x-s,f.y-s,this.width,this.width),c++,r=f}});const n=i[i.length-1];!n.isEnd&&!o.hide&&(t.strokeStyle=o.strokeColor,t.fillStyle=o.fillColor,t.fillRect(n.endPoint.x-s,n.endPoint.y-s,this.width,this.width),t.strokeRect(n.endPoint.x-s+.5,n.endPoint.y-s+.5,this.width-1,this.width-1))}}function P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const v=P(C);var p={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function E(e){var t,i=[],o=1,s;if(typeof e=="string")if(e=e.toLowerCase(),v[e])i=v[e].slice(),s="rgb";else if(e==="transparent")o=0,s="rgb",i=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(e)){var n=e.slice(1),a=n.length,u=a<=4;o=1,u?(i=[parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16)],a===4&&(o=parseInt(n[3]+n[3],16)/255)):(i=[parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16)],a===8&&(o=parseInt(n[6]+n[7],16)/255)),i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0),s="rgb"}else if(t=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(e)){var d=t[1],m=d==="rgb",n=d.replace(/a$/,"");s=n;var a=n==="cmyk"?4:n==="gray"?1:3;i=t[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(r,c){if(/%$/.test(r))return c===a?parseFloat(r)/100:n==="rgb"?parseFloat(r)*255/100:parseFloat(r);if(n[c]==="h"){if(/deg$/.test(r))return parseFloat(r);if(p[r]!==void 0)return p[r]}return parseFloat(r)}),d===n&&i.push(1),o=m||i[a]===void 0?1:i[a],i=i.slice(0,a)}else e.length>10&&/[0-9](?:\s|\/)/.test(e)&&(i=e.match(/([0-9]+)/g).map(function(g){return parseFloat(g)}),s=e.match(/([a-z])/ig).join("").toLowerCase());else isNaN(e)?Array.isArray(e)||e.length?(i=[e[0],e[1],e[2]],s="rgb",o=e.length===4?e[3]:1):e instanceof Object&&(e.r!=null||e.red!=null||e.R!=null?(s="rgb",i=[e.r||e.red||e.R||0,e.g||e.green||e.G||0,e.b||e.blue||e.B||0]):(s="hsl",i=[e.h||e.hue||e.H||0,e.s||e.saturation||e.S||0,e.l||e.lightness||e.L||e.b||e.brightness]),o=e.a||e.alpha||e.opacity||1,e.opacity!=null&&(o/=100)):(s="rgb",i=[e>>>16,(e&65280)>>>8,e&255]);return{space:s,values:i,alpha:o}}function R(e,t){var i=E(e);return t==null&&(t=i.alpha),i.space[0]==="h"?i.space+["a(",i.values[0],",",i.values[1],"%,",i.values[2],"%,",t,")"].join(""):i.space+["a(",i.values,",",t,")"].join("")}class M{constructor(t="yellow",i=8,o=.3){this.width=i,this.color=R(t,.4)}draw(t,i){const o=i[0];t.beginPath(),t.lineWidth=this.width,t.strokeStyle=this.color,t.lineCap="butt",t.miterLimit=1,t.moveTo(o.startPoint.x,o.startPoint.y),i.forEach(s=>{const{endPoint:n}=s;t.lineTo(n.x,n.y)}),t.stroke()}}h.EraserTool=S,h.HighlighterTool=M,h.Manager=b,h.PenTool=T,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
